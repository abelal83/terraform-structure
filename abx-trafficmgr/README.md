# Describe folder contents and structure here

_all_envs - think of this as a function that runs for all environments.
Add resources in here that should be created for any environment and regions.
It expects a single input object, config. This config should be generated by the config module.

_config - responsible for generating configuration values for use by all modules.
No resources are ever created by config, its sole responsibility is to simplify configuration across all modules.
It expects a single input, settings. This setting should be passed by env modules and consumed by env child modules.

_global - responsible for creating single instance resources
    Why? Using count or foreach for resources that we know are global is not correct.
It expects a single input, config. This config should be generated by the config module.

Inside env folders such as dev, the only thing that needs to change is the contents of the locals.tf. The values of which are fed to _config.
main.tf should generally be left alone.

- Separate configuration by environments
- https://developer.hashicorp.com/terraform/tutorials/modules/organize-configuration#separate-configuration
- https://developer.hashicorp.com/terraform/tutorials/modules/organize-configuration#separate-states

Why does env modules use locals instead of vars?
As per Hashicorp documentation from https://developer.hashicorp.com/terraform/language/values/locals
"Local values are like a function's temporary local variables." 

Unlike variables found in programming languages, Terraform's locals do not change values during or between Terraform runs such as plan, apply, or destroy. You can use locals to give a name to the result of any Terraform expression, and re-use that name throughout your configuration. Unlike input variables, locals are not set directly by users of your configuration. - https://developer.hashicorp.com/terraform/tutorials/configuration-language/locals 
variables are for "input" only. If the values do not change within a context of a module variables should not be used as it'll never change.

Setting terraform context to a env folder treats it as a the root module. This in turn calls child modules, taking into effect module composition.

to test you simply run terraform init and plan by changing to each env directory
module distinction is clear
module composition as each environment is a module
centralized configuration with config generator
a single configuration object is used across all modules
environment flexibility
module versioning support per module
dependency inversion support with conditional creation of objects
parent and child module support
blue/green support
works well with pr based git branching model

changes

https://cloudcasts.io/course/terraform/environment-directories
https://www.terraform-best-practices.com/examples/terraform/medium-size-infrastructure
scales well to large infra https://www.terraform-best-practices.com/examples/terraform/large-size-infrastructure-with-terraform

supports different provider, module and resource versions, should you need to. Or can enforce.


workspaces

https://developer.hashicorp.com/terraform/language/state/workspaces

Each Terraform configuration has an associated backend that defines how Terraform executes operations and where Terraform stores persistent data, like state.

The persistent data stored in the backend belongs to a workspace. The backend initially has only one workspace containing one Terraform state associated with that configuration. Some backends support multiple named workspaces, allowing multiple states to be associated with a single configuration. The configuration still has only one backend, but you can deploy multiple distinct instances of that configuration without configuring a new backend or changing authentication credentials.


https://developer.hashicorp.com/terraform/cli/workspaces#use-cases

Workspaces can be helpful for specific use cases, but they are not required to use the Terraform CLI. We recommend using alternative approaches for complex deployments requiring separate credentials and access controls.

Workspaces in the Terraform CLI refer to separate instances of state data inside the same Terraform working directory. They are distinctly different from workspaces in Terraform Cloud, which each have their own Terraform configuration and function as separate working directories.